var AdsVisibilityTrack;(function(n){function u(n,t,i,r){var h,s;if(r===void 0&&(r=!0),!n||n.style.visibility==="hidden"||n.style.opacity==="0")return!1;var u=n.getBoundingClientRect(),f=u.width,e=u.height;return(u.left<0&&u.left+u.width>window.innerWidth?f=window.innerWidth:u.left<0?f+=u.left:u.left+u.width>window.innerWidth&&(f=window.innerWidth-u.left),u.top<0&&u.height+u.top>=window.innerHeight?e=window.innerHeight:u.top<0?e+=u.top:u.top+u.height>=window.innerHeight&&(e=window.innerHeight-u.top),f<0||e<0)?!1:(h=f*e/(u.width*u.height),h>=t&&(s=r?o(n,i):-1,s===-1||s>=t))?!0:!1}function o(n,t){for(var o,i=n.getBoundingClientRect(),s=i.height*i.width,u=n.parentElement,r=undefined,e,l,a;u!=null;){if(getComputedStyle(u,null).overflowX==="hidden"||getComputedStyle(u,null).overflowX==="auto"||getComputedStyle(u,null).overflowY==="hidden"||getComputedStyle(u,null).overflowY==="auto"){r=u.getBoundingClientRect();break}u=u.parentElement}if(t&&(r=(o=p(n,t))===null||o===void 0?void 0:o.getBoundingClientRect()),r){var h=Math.max(Math.max(0,i.top),r.top),c=Math.min(Math.min(window.innerHeight,i.top+i.height),r.top+r.height),f=0;return(c-h>0&&(f=c-h),i.left<r.left&&i.left+i.width>r.left)?(e=i.left+i.width-Math.max(0,i.left),e*f/s):r.left+r.width<i.left+i.width&&i.left<r.left+r.width?(e=Math.min(window.innerWidth,r.left+r.width)-i.left,e*f/s):i.left>=r.left&&i.left+i.width<=r.left+r.width?(l=Math.max(0,i.left),a=Math.min(window.innerWidth,i.left+i.width),(a-l)*f/s):0}return-1}function r(i,r,f,e,o,s,h,c){var v=n.cbPool[r].visibleAreaThreshold,y=n.cbPool[r].visibleTimeThreshold,a;if(f){a=u(i,v,c);sj_ue(_w,"scroll",t);sj_ue(_d,"click",t);sj_evt.unbind("customScrolled",t);sj_evt.unbind("slideexp_scroll",t);sj_evt.unbind("WaterfallScrolled",t);sj_evt.unbind("ZVSLHover",t);sj_be(_w,"scroll",l);sj_be(_d,"click",l);sj_evt.bind("customScrolled",l);sj_evt.bind("slideexp_scroll",l);sj_evt.bind("WaterfallScrolled",l);sj_evt.bind("ZVSLHover",l);function l(){performance.now()-e>=y&&(sj_ue(_w,"scroll",l),sj_ue(_d,"click",l),sj_evt.unbind("customScrolled",l),sj_evt.unbind("slideexp_scroll",l),sj_evt.unbind("WaterfallScrolled",l),sj_evt.unbind("ZVSLHover",l),sj_be(_w,"scroll",t),sj_be(_d,"click",t),sj_evt.bind("customScrolled",t),sj_evt.bind("slideexp_scroll",t),sj_evt.bind("WaterfallScrolled",t),sj_evt.bind("ZVSLHover",t),h(f,r,a,o,s));a=u(i,v,c)&&a}setTimeout(function(){sj_ue(_w,"scroll",l);sj_ue(_d,"click",l);sj_evt.unbind("customScrolled",l);sj_evt.unbind("slideexp_scroll",l);sj_evt.unbind("WaterfallScrolled",l);sj_evt.unbind("ZVSLHover",l);sj_be(_w,"scroll",t);sj_be(_d,"click",t);sj_evt.bind("customScrolled",t);sj_evt.bind("slideexp_scroll",t);sj_evt.bind("WaterfallScrolled",t);sj_evt.bind("ZVSLHover",t);h(f,r,a,o,s)},y)}}function f(i,r,f,e,o,s,h){var l=n.cbPool[r].visibleAreaThreshold,a=n.cbPool[r].isChatHoverAd,c;f&&(sj_evt.unbind("CibHoverCard.Visible",t),c=u(i,l,h,!a),s(f,r,c,e,o),sj_evt.bind("CibHoverCard.Visible",t))}function c(t,i,r,u,f,e,o,s){s===void 0&&(s=!1);n.cbPool[t]={whenToInvoke:r,attribute:i,visibleTimeThreshold:u,visibleAreaThreshold:f,cbFunc:e,container:o,isChatHoverAd:s}}function s(n,t,i,r){if(t===i)return!1;if(n%2==1){if(n===1||n===3&&t===!1||n===5&&t===!0)return!r}else return t?n!=4:n<5;return!1}function i(t,i,r,u,f){if((typeof n.dataStorage[u]=="undefined"||n.dataStorage[u]===null)&&(n.dataStorage[u]=[]),t in n.attrPool){var e=s(n.cbPool[i].whenToInvoke,r,n.attrPool[t].visibility,n.attrPool[t].dataSend);e&&(n.attrPool[t].dataSend=!0,n.attrPool[t].visibility=r,n.dataStorage[u].push({attrValue:t,visibility:r}))}else n.attrPool[t]={cbName:i,visibility:r,dataSend:!1},r&&n.dataStorage[u].push({attrValue:t,visibility:r});f&&n.dataStorage[u].length!==0&&(n.cbPool[i].cbFunc(n.dataStorage[u]),Log.Log("Ads","Civis",n.cbPool[i].attribute,!1,t,r.toString()),sj_evt.fire("sendData"))}function l(t,u){var f=_ge(t),e=Object.keys(n.dataStorage).length+1;if(n.dataStorage[e]=[],f&&(n.idPool[t]=u,u in n.cbPool)){var o=f.getAttribute(n.cbPool[u].attribute),s=n.cbPool[u].container,h=n.cbPool[u].isChatHoverAd;h||r(f,u,o,performance.now(),e,!0,i,s)}}function a(t,u){var e=document.getElementsByClassName(t),s=Object.keys(n.dataStorage).length+1,o,f;if(n.dataStorage[s]=[],o=!1,e&&(n.classPool[t]=u,u in n.cbPool))for(f=0;f<e.length;f++){var h=e[f].getAttribute(n.cbPool[u].attribute),c=n.cbPool[u].container,l=n.cbPool[u].isChatHoverAd;f===e.length-1&&(o=!0);e[f]instanceof HTMLElement&&!l&&r(e[f],u,h,performance.now(),s,o,i,c)}}function v(){n.idPool={};n.classPool={};n.attrPool={};n.cbPool={};n.dataStorage={}}function y(n,t){return n!=null&&(n.className===t||n.className.indexOf(t+" ")>-1||n.className.indexOf(" "+t)>-1)}function p(n,t){for(var i=n.parentElement;i;){if(y(i,t))break;i=i.parentElement}return i}function t(n){if(n&&n[0]==="CibHoverCard.Visible")setTimeout(h,20,!0);else{window.clearTimeout(e);var t=n.type==="click"?500:66;e=setTimeout(h,t,!1)}}function h(t){var l=Object.keys(n.dataStorage).length+1,p,e,o,s,h,w,u,y;n.dataStorage[l]=[];p=0;e=!1;for(o in n.classPool)if(p+=1,s=document.getElementsByClassName(o),s&&n.classPool[o]in n.cbPool)for(h=0;h<s.length;h++){p===Object.keys(n.classPool).length&&h===s.length-1&&Object.keys(n.idPool).length===0&&(e=!0);var a=s[h].getAttribute(n.cbPool[n.classPool[o]].attribute),v=n.cbPool[n.classPool[o]].container,c=n.cbPool[n.classPool[o]].isChatHoverAd;(t?c:!c)&&s[h]instanceof HTMLElement&&(c?f(s[h],n.classPool[o],a,l,e,i,v):r(s[h],n.classPool[o],a,performance.now(),l,e,i,v))}w=0;e=!1;for(u in n.idPool)if(w+=1,w===Object.keys(n.idPool).length&&(e=!0),y=_ge(u),y&&n.idPool[u]in n.cbPool){var a=_ge(u).getAttribute(n.cbPool[n.idPool[u]].attribute),v=n.cbPool[n.idPool[u]].container,c=n.cbPool[n.idPool[u]].isChatHoverAd;if(t?!c:c)continue;c?f(y,n.idPool[u],a,l,e,i,v):r(y,n.idPool[u],a,performance.now(),l,e,i,v)}}n.idPool={};n.classPool={};n.attrPool={};n.cbPool={};n.dataStorage={};var e;n.checkVisibility=u;n.checkOverFlow=o;n.checkVisibilityByTime=r;n.checkVisibilityOnce=f;n.registerAdVisibilityTrackCallback=c;n.checkSendData=s;n.sendData=i;n.initById=l;n.initByClass=a;n.clear=v;sj_be(_w,"scroll",t);sj_be(_d,"click",t);sj_evt.bind("customScrolled",t);sj_evt.bind("slideexp_scroll",t);sj_evt.bind("WaterfallScrolled",t);sj_evt.bind("ZVSLHover",t);sj_evt.bind("CibHoverCard.Visible",t);sj_evt.fire("onAdsVisibilityTrackLoad",n)})(AdsVisibilityTrack||(AdsVisibilityTrack={}))